
<!-- Hide/show certain divs according to URL (UMONS or noinstitution) -->
<script>
// Parse the URL parameter
function getParameterByName(name, url) {
  if (!url) url = window.location.href;
  name = name.replace(/[\[\]]/g, "\\$&");
//  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
//  results = regex.exec(url);
//  if (!results) {
    // Try to get the value from local storage
    if (window.localStorage) {
      return localStorage.getItem(name);
    } else {
      return '';
    }
//  }
//  var value = '';
//  if (results[2]) {
//    value = decodeURIComponent(results[2].replace(/\+/g, " "));
//    if (window.localStorage) {
//      localStorage.setItem(name, value);
//    }
//    return value;
//  }
}
// Collect parameters and store their values (as passed by Moodle)
var iemail      = getParameterByName('iemail');
//var iid         = getParameterByName('iid');
//var ifirstname  = getParameterByName('ifirstname');
//var ilastname   = getParameterByName('ilastname');
var institution = getParameterByName('institution');
var icourse     = getParameterByName('icourse');
//var iurl        = getParameterByName('iurl');
//var iref        = getParameterByName('iref');

function showUMONS() {
  var elems = document.getElementsByClassName('UMONS');
  for (i = 0; i < elems.length; i++) {
    var elem = elems[i];
    elem.style.display = 'block';
  }
  var elems = document.getElementsByClassName('noinstitution');
  for (i = 0; i < elems.length; i++) {
    var elem = elems[i];
    elem.style.display = 'none';
  }
}

function hideUMONS() {
  var elems = document.getElementsByClassName('UMONS');
  for (i = 0; i < elems.length; i++) {
    var elem = elems[i];
    elem.style.display = 'none';
  }
  var elems = document.getElementsByClassName('noinstitution');
  for (i = 0; i < elems.length; i++) {
    var elem = elems[i];
    elem.style.display = 'block';
  }
}

function showSdd1() {
  var elems = document.getElementsByClassName('sdd1');
  for (i = 0; i < elems.length; i++) {
    var elem = elems[i];
    elem.style.display = 'block';
  }
  var elems = document.getElementsByClassName('nocourse');
  for (i = 0; i < elems.length; i++) {
    var elem = elems[i];
    elem.style.display = 'none';
  }
}

function hideCourses() {
  var elems = document.getElementsByClassName('sdd1');
  for (i = 0; i < elems.length; i++) {
    var elem = elems[i];
    elem.style.display = 'none';
  }
  var elems = document.getElementsByClassName('nocourse');
  for (i = 0; i < elems.length; i++) {
    var elem = elems[i];
    elem.style.display = 'block';
  }
}

function processParameters() {
  // Content related to an institution
  if (institution == 'UMONS') {
    showUMONS();
  } else {
    hideUMONS();
  }
  // Content relative to a course
  if (icourse == 'S-BIOG-006') {
    showSdd1();
  } else {// TODO: also process the other courses
    hideCourses();
  }

  // Process other parameters too here...
}

window.onload = processParameters;
</script>

<!-- System diagnostic -->
<script>
function clearStorage() {
  localStorage.clear();
  alert("Informations personnelles locales effacees !" +
    "\nLa page va etre rechargee..." +
    "\nSi vous avez un compte ouvert sur ce site, vous pouvez aussi effacer l'historique dans le tableau de bord." +
    "\n\n(s'il s'agit d'une fausse manoeuvre, fermer la page et relancez-la depuis Moodle).");
  window.location.href=window.location.href;
}

function diagnoseSystem() {
  var container = document.getElementById('diagnostic');
  if (container === null) {
    return;
  }
  var content = "";

  if (!window.localStorage) {
    content = content + "<p>Vous &ecirc;tes&nbsp;:</p>\n<ul>";
    content = content + "\n<li>Anonyme sur ce site (stockage local indisponible).</li>";
    content = content + "\n<li>Le contenu <b>n'est pas</b> contextualis&eacute; par rapport &agrave; un cours en particulier.</li>";
    content = content + "\n<li>Le r&eacute;sultat de certains exercices <b>ne sera pas enregistr&eacute;</b>.</li>";
    content = content + "\n</ul>";
    content = content + "\n<p>Si vous n'&ecirc;tes <i>pas</i> un &eacute;tudiant qui suit un cours lié à ce mat&eacute;riel p&eacute;dagogique, c'est normal, vous pouvez continuer votre visite... <b>Bienvenue&nbsp;!</b></p>";
    content = content + "\n<p>En revanche, si votre cours n&eacute;cessite que vous soyez d&ucirc;ment enregistr&eacute;, alors fermez cette page et relancer-l&agrave; depuis le syst&egrave;me d'apprentissage en ligne de votre Universit&eacute; (Moodle, ...). Si ce message se reproduit, contactez vos enseignants.</p>";

  } else {
    // Explore the content of the storage
    // Students are recognized by iemail (institutional email, or (local) email)
    // but possibly, their login could be used too
    var login = '';
    var email = localStorage.getItem('iemail');
    if (email === null || email == '') {
      email = localStorage.getItem('email');
    }
    if (email === null || email == '') {
      email = '';
      login = localStorage.getItem('login');
      if (login === null) {
        login = '';
      }
    }

    content = content + "<p><b>Le contenu de ce cours est contextuel.</b> V&eacute;rifiez les informations suivantes, s'il-vous-plait&nbsp;:</p>\n<ul>";

    var registered = false;
    if (email == '' && login == '') {
      // Not registered
      content = content + "\n<li><u>Vous &ecirc;tes anonyme sur ce site.</u> <b>Votre progression dans les exercices ne sera pas enregistr&eacute;e.</b></li>";

    } else {
      // Registered user
      registered = true;
      var msg = '';
      if (email != '') {
        msg = "Email&nbsp;: <u>" + email + "</u>";
      } else {
        msg = "Login&nbsp;: <u>" + login + "</u>";
      }      content = content + "\n<li>" + msg + ". <b>Votre progression dans les exercices sera enregistr&eacute;e sous cette r&eacute;f&eacute;rence.</b></li>";
    }

    // institution and icourse possibly change the content. So, must be checked!
    var context = false;
    var institution = localStorage.getItem('institution');
    if (institution == null || institution == '') {
      institution = 'ind&eacute;termin&eacute;e';
    } else {
      context = true;
    }
    var icourse = localStorage.getItem('icourse');
    if (icourse == null || icourse == '') {
      icourse = 'ind&eacute;termin&eacute;';
    } else {
      context = true;
    }
    // Translate a few known courses (TODO: check the Moodle short names!)
    if (icourse == "S-BIOG-006") {
      icourse = "Science des donn&eacute;es I : visualisation et inf&eacute;rence (Bab2 Bio)";
    }
    if (icourse == "S-BIOG-007") {
      icourse = "Science des donn&eacute;es II : analyse et mod&eacute;lisation (Bab3 Bio)";
    }
    if (icourse == "S-BIOG-008") {
      icourse = "Science des donn&eacute;es III : exploration et pr&eacute;diction (Ma1 BBMC/BOE)";
    }
    if (icourse == "S-BIOG-009") {
      icourse = "Science des donn&eacute;es IV : pratique (Ma2 BBMC/BOE)";
    }
    if (icourse == "S-BIOG-010") {
      icourse = "Science des donn&eacute;es V : recherche reproductible (Ma2 BBMC/BOE)";
    }
    if (icourse == "S-BIOG-926") {
      icourse = "Bio-informatique et science des donn&eacute;es I (Bab2 Bio Charleroi)";
    }
    if (icourse == "S-BIOG-940") {
      icourse = "Bio-informatique et science des donn&eacute;es II (Bab3 Bio Charleroi)";
    }

    content = content + "\n<li>Cours&nbsp;: <u>" + icourse + "</u></li>";
    content = content + "\n<li>Institution&nbsp;: <u>" + institution + "</u></li>";
    content = content + "\n</ul>";
    if (context) {
      content = content + "<p><b>Le contenu sera adapt&eacute; en fonction de ce contexte.</b> Vérifiez qu'il est correct, sinon fermez cette page et relancer-l&agrave; depuis le syst&egrave;me d'apprentissage en ligne de votre Universit&eacute; (Moodle, ...). Si ce message se reproduit, contactez vos enseignants.</p>";
    } else {// No context
      content = content + "<p><b>N'&eacute;tant dans aucun contexte de cours particulier, vous n'aurez acc&egrave;s qu'&agrave un contenu g&eacute;n&eacute;raliste.</b> Si c'est ce que vous souhaitez... bienvenue&nbsp;! Sinon, fermez cette page et relancer-l&agrave; depuis le syst&egrave;me d'apprentissage en ligne de votre Universit&eacute; (Moodle, ...). Si ce message se reproduit, contactez vos enseignants.</p>";
    }

    // If registered user and/or special context, offer to reset it
    if (registered || context) {
      content = content + "\n<p>Pour explorer ces pages de mani&egrave;re anonyme et n'enregistrer aucune activit&eacute;, vous pouvez &eacute;liminez vos informations personnelles en cliquant sur le bouton juste ci-dessous.</p>";
      content = content + "<button onclick=\"clearStorage()\">Effacer mes donn&eacute;es personnelles</button>";
    }

    // TODO: message + button to reset infos

    // Those variables are possibly defined, but they are not tested here (yet)
    //var displayname = localStorage.getItem('displayname');
    //var firstname = localStorage.getItem('firstname');
    //var lastname = localStorage.getItem('lastname');
    //var ifirstname = localStorage.getItem('ifirstname');
    //var ilastname = localStorage.getItem('ilastname');
    //var iid = localStorage.getItem('iid');
    //var iurl = localStorage.getItem('iurl');
    //var iref = localStorage.getItem('iref');
  }

  container.innerHTML = content;
}
</script>

<!-- Show/hide R output as details -->
<script>
//(function() {
//  var codes = document.querySelectorAll('pre:not([class])');
//  var code, i, d, s, p;
//  for (i = 0; i < codes.length; i++) {
//    code = codes[i];
//    p = code.parentNode;
//    d = document.createElement('details');
//    s = document.createElement('summary');
//    s.innerText = 'Details';
//    // <details><summary>Details</summary></details>
//    d.appendChild(s);
//    // move the code into <details>
//    p.replaceChild(d, code);
//    d.appendChild(code);
//  }
//})();
</script>

<!-- Pass URL arguments to iframe 'app' (embedded shiny app) & 'h5p' -->
<script>
var params = window.location.toString().split('?')[1];
// Detect if we have the Sepia or Night theme
if (document.getElementsByClassName('color-theme-1')) {
  if (params === undefined) {
    params = "theme=Sepia";
  } else {
    params = params + '&theme=Sepia';
  }
}
if (document.getElementsByClassName('color-theme-22')) {
  if (params === undefined) {
    params = "theme=Night";
  } else {
    params = params + '&theme=Night';
  }
}

if (params !== undefined) {
  var apps = document.getElementsByClassName('app');
  for (i = 0; i < apps.length; i++) {
    var appitem = apps[i];
    appitem.src = appitem.src + '?' + params;
  }

  var h5ps = document.getElementsByClassName('h5p');
  for (i = 0; i < h5ps.length; i++) {
    var h5pitem = h5ps[i];
    h5pitem.src = h5pitem.src + '&' + params;
  }
}
</script>

<!-- Launch the app on click with URL parameters + theme -->
<script>
launchApp = function(id, src) {
  var params = window.location.toString().split('?')[1];
  // Detect if we have the Sepia or Night theme
  if (document.getElementsByClassName('color-theme-1')[0]) {
    if (params === undefined) {
      params = "theme=Sepia";
    } else {
      params = params + '&theme=Sepia';
    }
  }
  if (document.getElementsByClassName('color-theme-2')[0]) {
    if (params === undefined) {
      params = "theme=Night";
    } else {
      params = params + '&theme=Night';
    }
  }
  if (params !== undefined) {
    src = src + '?' + params;
  }
  var img = document.getElementById('img' + id);
  var app = document.getElementById(id);
  app.src = src;
  app.style.display='block';
  img.style.display='none';
}
</script>


<!-- Required for H5P xAPI feedback -->

<script>H5PIntegration = {"baseUrl":"https:\/\/wp.sciviews.org","url":"\/wp-content\/uploads\/h5p","postUserStatistics":false,"ajax":{"setFinished":"https:\/\/wp.sciviews.org\/wp-admin\/admin-ajax.php?token=e6b10366a6&action=h5p_setFinished","contentUserData":"https:\/\/wp.sciviews.org\/wp-admin\/admin-ajax.php?token=ea1774d67b&action=h5p_contents_user_data&content_id=:contentId&data_type=:dataType&sub_content_id=:subContentId"},"saveFreq":"30","siteUrl":"https:\/\/wp.sciviews.org","l10n":{"H5P":{"fullscreen":"Fullscreen","disableFullscreen":"Disable fullscreen","download":"Download","copyrights":"Rights of use","embed":"Embed","size":"Size","showAdvanced":"Show advanced","hideAdvanced":"Hide advanced","advancedHelp":"Include this script on your website if you want dynamic sizing of the embedded content:","copyrightInformation":"Rights of use","close":"Close","title":"Title","author":"Author","year":"Year","source":"Source","license":"License","thumbnail":"Thumbnail","noCopyrights":"No copyright information available for this content.","reuse":"Reuse","reuseContent":"Reuse Content","reuseDescription":"Reuse this content.","downloadDescription":"Download this content as a H5P file.","copyrightsDescription":"View copyright information for this content.","embedDescription":"View the embed code for this content.","h5pDescription":"Visit H5P.org to check out more cool content.","contentChanged":"This content has changed since you last used it.","startingOver":"You'll be starting over.","by":"by","showMore":"Show more","showLess":"Show less","subLevel":"Sublevel","confirmDialogHeader":"Confirm action","confirmDialogBody":"Please confirm that you wish to proceed. This action is not reversible.","cancelLabel":"Cancel","confirmLabel":"Confirm","licenseU":"Undisclosed","licenseCCBY":"Attribution","licenseCCBYSA":"Attribution-ShareAlike","licenseCCBYND":"Attribution-NoDerivs","licenseCCBYNC":"Attribution-NonCommercial","licenseCCBYNCSA":"Attribution-NonCommercial-ShareAlike","licenseCCBYNCND":"Attribution-NonCommercial-NoDerivs","licenseCC40":"4.0 International","licenseCC30":"3.0 Unported","licenseCC25":"2.5 Generic","licenseCC20":"2.0 Generic","licenseCC10":"1.0 Generic","licenseGPL":"General Public License","licenseV3":"Version 3","licenseV2":"Version 2","licenseV1":"Version 1","licensePD":"Public Domain","licenseCC010":"CC0 1.0 Universal (CC0 1.0) Public Domain Dedication","licensePDM":"Public Domain Mark","licenseC":"Copyright","contentType":"Content Type","licenseExtras":"License Extras","changes":"Changelog","contentCopied":"Content is copied to the clipboard","connectionLost":"Connection lost. Results will be stored and sent when you regain connection.","connectionReestablished":"Connection reestablished.","resubmitScores":"Attempting to submit stored results.","offlineDialogHeader":"Your connection to the server was lost","offlineDialogBody":"We were unable to send information about your completion of this task. Please check your internet connection.","offlineDialogRetryMessage":"Retrying in :num....","offlineDialogRetryButtonLabel":"Retry now","offlineSuccessfulSubmit":"Successfully submitted results."}},"hubIsEnabled":true,"reportingIsEnabled":true,"libraryConfig":null,"crossorigin":null,"crossoriginCacheBuster":null,"pluginCacheBuster":"?v=1.15.0","libraryUrl":"https:\/\/wp.sciviews.org\/wp-content\/plugins\/h5p\/h5p-php-library\/js","core":{"styles":["\/wp-content\/plugins\/h5p\/h5p-php-library\/styles\/h5p.css?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/styles\/h5p-confirmation-dialog.css?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/styles\/h5p-core-button.css?ver=1.15.0"],"scripts":["\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/jquery.js?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/h5p.js?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/h5p-event-dispatcher.js?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/h5p-x-api-event.js?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/h5p-x-api.js?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/h5p-content-type.js?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/h5p-confirmation-dialog.js?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/h5p-action-bar.js?ver=1.15.0","\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/request-queue.js?ver=1.15.0"]},"loadedJs":[],"loadedCss":[],"contents":{"cid-7":{"library":"H5P.MultiChoice 1.14","jsonContent":"{\"answers\":[{\"correct\":false,\"tipsAndFeedback\":{\"tip\":\"\",\"chosenFeedback\":\"\",\"notChosenFeedback\":\"\"},\"text\":\"<div>The header of the document<\\\/div>\\n\"},{\"correct\":true,\"tipsAndFeedback\":{\"tip\":\"\",\"chosenFeedback\":\"<div>Excellent! A chunk is indeed a special area delimited by \\u0010\\u0010```{R} and ``` tags that contains R code to be evaluated in place when the document is compiled.<\\\/div>\\n\",\"notChosenFeedback\":\"<div>Oww! You should go back to the capsule about R Markdown to learn what a chunk is.<\\\/div>\\n\"},\"text\":\"<div>An area that contains R code<\\\/div>\\n\"},{\"correct\":false,\"tipsAndFeedback\":{\"tip\":\"\",\"chosenFeedback\":\"\",\"notChosenFeedback\":\"\"},\"text\":\"<div>A area that contains markdown text<\\\/div>\\n\"}],\"overallFeedback\":[{\"from\":0,\"to\":100}],\"UI\":{\"checkAnswerButton\":\"Check\",\"showSolutionButton\":\"Show solution\",\"tryAgainButton\":\"Retry\",\"tipsLabel\":\"Show tip\",\"scoreBarLabel\":\"You got :num out of :total points\",\"tipAvailable\":\"Tip available\",\"feedbackAvailable\":\"Feedback available\",\"readFeedback\":\"Read feedback\",\"wrongAnswer\":\"Wrong answer\",\"correctAnswer\":\"Correct answer\",\"shouldCheck\":\"Should have been checked\",\"shouldNotCheck\":\"Should not have been checked\",\"noInput\":\"Please answer before viewing the solution\"},\"behaviour\":{\"enableRetry\":true,\"enableSolutionsButton\":true,\"enableCheckButton\":true,\"type\":\"auto\",\"singlePoint\":true,\"randomAnswers\":true,\"showSolutionsRequiresInput\":true,\"confirmCheckDialog\":false,\"confirmRetryDialog\":false,\"autoCheck\":false,\"passPercentage\":100,\"showScorePoints\":true},\"confirmCheck\":{\"header\":\"Finish ?\",\"body\":\"Are you sure you wish to finish ?\",\"cancelLabel\":\"Cancel\",\"confirmLabel\":\"Finish\"},\"confirmRetry\":{\"header\":\"Retry ?\",\"body\":\"Are you sure you wish to retry ?\",\"cancelLabel\":\"Cancel\",\"confirmLabel\":\"Confirm\"},\"question\":\"<p>What is a chunk in R Markdown?<\\\/p>\\n\",\"media\":{\"disableImageZooming\":false}}","fullScreen":"0","exportUrl":"\/wp-content\/uploads\/h5p\/exports\/multiple-choice-7.h5p","embedCode":"<iframe src=\"https:\/\/wp.sciviews.org\/wp-admin\/admin-ajax.php?action=h5p_embed&id=7\" width=\":w\" height=\":h\" frameborder=\"0\" allowfullscreen=\"allowfullscreen\"><\/iframe>","resizeCode":"<script src=\"https:\/\/wp.sciviews.org\/wp-content\/plugins\/h5p\/h5p-php-library\/js\/h5p-resizer.js\" charset=\"UTF-8\"><\/script>","url":"https:\/\/wp.sciviews.org\/wp-admin\/admin-ajax.php?action=h5p_embed&id=7","title":"multiple-choice","displayOptions":{"frame":false,"export":false,"embed":true,"copyright":false,"icon":false,"copy":false},"metadata":{"title":"multiple-choice","license":"U"},"contentUserData":[{"state":"{}"}],"scripts":["\/wp-content\/uploads\/h5p\/cachedassets\/bbb484ab91a596c1d881578ee3d99ab92df05f05.js","https:\/\/wp.sciviews.org\/wp-content\/plugins\/h5pxapikatchu\/js\/h5pxapikatchu-listener.js?ver=0.4.2"],"styles":["\/wp-content\/uploads\/h5p\/cachedassets\/bbb484ab91a596c1d881578ee3d99ab92df05f05.css"]}}};</script><link rel='stylesheet' id='h5p-core-styles-h5p-css'  href='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/styles/h5p.css' media='all' />
<link rel='stylesheet' id='h5p-core-styles-h5p-confirmation-dialog-css'  href='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/styles/h5p-confirmation-dialog.css' media='all' />
<link rel='stylesheet' id='h5p-core-styles-h5p-core-button-css'  href='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/styles/h5p-core-button.css' media='all' />
<script src='https://wp.sciviews.org/wp-includes/js/wp-embed.min.js'></script>

<!--
<script src='https://wp.sciviews.org/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp'></script>
<script src='https://wp.sciviews.org/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
-->

<script>
var wpAJAXurl = "https:\/\/wp.sciviews.org\/wp-admin\/admin-ajax.php";
var debugEnabled = "0";
var captureAllH5pContentTypes = "1";
var h5pContentTypes = [""];
</script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5pxapikatchu/js/h5pxapikatchu-variables.js'></script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/js/jquery.js'></script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/js/h5p.js'></script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/js/h5p-event-dispatcher.js'></script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/js/h5p-x-api-event.js'></script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/js/h5p-x-api.js'></script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/js/h5p-content-type.js'></script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/js/h5p-confirmation-dialog.js'></script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/js/h5p-action-bar.js'></script>
<script src='https://wp.sciviews.org/wp-content/plugins/h5p/h5p-php-library/js/request-queue.js'></script>
